# 灵魂画手 GUI 完整使用指南

## 概述

**灵魂画手 v1.0** 是一款专业的 AI 视频二创工具,支持多种 AI 平台,可以自动提取视频中的搞笑场景并生成手绘风格插画。

### 核心功能

1. **视频分析**: 自动识别视频中的搞笑场景
2. **手绘生成**: 将关键帧转换为手绘漫画风格
3. **视频合成**: 将手绘插画叠加到原视频并配上BGM
4. **批量处理**: 支持批量处理多个视频文件

## 界面说明

### 启动软件

```bash
python gui_main_compact.py
```

### 界面布局

软件采用紧凑的**选项卡式布局**,分为2个主要选项卡:

#### 1. 基础设置选项卡

**📁 视频文件区域**:
- **处理模式**:
  - 单个文件: 处理一个视频
  - 批量处理: 处理整个文件夹的视频
- **文件选择**: 浏览按钮选择视频文件
- **文件夹选择**: 批量模式下选择包含视频的文件夹

**🤖 AI模式区域** (用于图像编辑):
- **模式下拉菜单**: 选择图像生成AI
  - 通义千问(推荐)
  - Gemini
  - DeepSeek
  - 月之暗面(Kimi)
  - 智谱AI
  - 百川智能
  - 01.AI(零一万物)
  - OpenAI官方
  - 自定义OpenAI兼容
  - 模拟模式(无需网络)

- **API密钥**: 输入对应平台的API密钥
- **测试按钮**: 测试API连接是否正常
- **连接状态**: 显示API连接状态

**自定义配置** (选择"自定义OpenAI兼容"时显示):
- **Base URL**: API服务地址(如 http://localhost:8000)
- **模型名称**: 模型名称(如 dall-e-3)

#### 2. 高级设置选项卡

**🎥 视频分析模式** ⭐ 新增功能:
- **分析模式下拉菜单**:
  - **Ollama本地模型(推荐)** ✨ 新增
    - 完全本地运行
    - 无需网络
    - 数据隐私保护
    - 免费使用
  - **Google Gemini**
    - 云端视频理解
    - 效果最好
    - 需要API密钥
  - **通义千问视频**
    - 阿里云服务
    - 需要API密钥
  - **自定义逐帧API**
    - 对接自己的推理服务
  - **模拟模式**
    - 测试用

- **Ollama模型选择**:
  - llava (推荐,速度快)
  - llava:13b (效果更好,速度中等)
  - llava:34b (效果最好,速度慢)
  - bakllava
  - llava-phi3
  - llava-llama3

**视频参数**:
- **抽帧间隔**: 每隔多少毫秒抽取一帧(默认5000ms=5秒)
- **搞笑阈值**: 0.1-1.0之间,分数高于此值的场景才会被选中
- **BGM音量**: 背景音乐音量(0.0-1.0)

**图片生成控制**:
- **最大图片数**: 最多生成多少张手绘插画
- **最小间隔**: 两张图片之间最少间隔秒数
- **每分钟张数**: 每分钟平均生成多少张图片
- **智能限制模式**: 自动调整图片密度

### 操作按钮

- **🎬 开始生成**: 开始处理视频
- **⏹️ 停止**: 停止当前处理
- **📁 打开输出**: 打开输出文件夹

### 进度显示

- **进度条**: 显示处理进度(0-100%)
- **状态标签**: 显示当前处理状态

### 日志输出

实时显示处理过程中的日志信息

## 使用流程

### 1. 使用 Ollama 本地模式(推荐新用户)

这是**最简单、最私密**的方式,完全本地运行,无需API密钥!

#### 步骤1: 安装 Ollama

1. 访问 https://ollama.com/download
2. 下载并安装 Windows 版本
3. 安装后会自动运行在后台

#### 步骤2: 下载视觉模型

打开命令行(CMD或PowerShell),运行:

```bash
# 下载推荐模型(约4GB)
ollama pull llava

# 可选: 下载更大的模型
ollama pull llava:13b
```

#### 步骤3: 配置软件

1. 启动 **灵魂画手 GUI**: `python gui_main_compact.py`
2. 切换到 **"高级设置"** 选项卡
3. 在 **"视频分析模式"** 中选择 **"Ollama本地模型(推荐)"**
4. 在 **"Ollama模型"** 中选择 **"llava"**
5. 回到 **"基础设置"** 选项卡
6. 在 **"AI模式"** 中选择图像生成模式(如 "自定义OpenAI兼容")
7. 如果使用自定义模式,配置 Base URL 和 API 密钥

#### 步骤4: 处理视频

1. 点击 **"浏览"** 选择视频文件
2. 点击 **"🎬 开始生成"**
3. 等待处理完成(进度条会显示进度)
4. 点击 **"📁 打开输出"** 查看结果

### 2. 使用云端 API(需要API密钥)

#### Gemini 模式

1. 获取 Gemini API 密钥: https://makersuite.google.com/app/apikey
2. 在 **"高级设置"** 中选择视频分析模式 **"Google Gemini"**
3. 在 **"基础设置"** 的AI模式中选择 **"Gemini"**
4. 输入 API 密钥
5. 点击 **"测试"** 验证连接
6. 开始处理视频

#### 通义千问模式

1. 获取通义千问 API 密钥: https://dashscope.aliyun.com/
2. 在 **"基础设置"** 中选择 **"通义千问(推荐)"**
3. 输入 API 密钥
4. 点击 **"测试"** 验证连接
5. 开始处理视频

### 3. 批量处理多个视频

1. 将多个视频文件放在同一个文件夹中
2. 在 **"视频文件"** 区域选择 **"批量处理"** 模式
3. 点击 **"文件夹"** 按钮选择文件夹
4. 配置AI模式和视频分析模式
5. 点击 **"🎬 开始生成"**
6. 软件会自动处理文件夹中的所有视频
7. 完成后会显示统计信息(成功/失败数量)

## 配置详解

### config.ini 配置文件

软件会自动读取和保存配置到 `config.ini` 文件。

#### 视频分析配置段

```ini
[video_analysis]
; 分析模式
mode = ollama

; 是否启用
enabled = true

; Ollama 配置
base_url = http://localhost:11434
model = llava
api_key = not-needed
```

可选模式:
- `ollama`: 本地 Ollama 视觉模型
- `gemini`: Google Gemini 视频理解
- `qwen_video`: 通义千问视频分析
- `frame_by_frame`: 自定义逐帧API
- `simulate`: 模拟模式

#### 图像编辑配置段

```ini
[custom]
enabled = true
base_url = http://localhost:8000
model = dall-e-3
api_key = sk-token1
```

#### 视频参数配置

```ini
[video]
frame_interval = 5000  ; 抽帧间隔(毫秒)

[google_vision]
funny_score_threshold = 0.85  ; 搞笑阈值
max_images = 6  ; 最大图片数
min_interval_seconds = 5.0  ; 最小间隔
images_per_minute = 2.0  ; 每分钟图片数
```

## 常见问题

### Q1: Ollama模式显示"服务未响应"?

**解决方案**:
```bash
# 检查Ollama是否运行
curl http://localhost:11434/api/tags

# 如果失败,重启Ollama服务
# Windows: 在任务管理器中结束 Ollama.exe,然后重新打开
```

### Q2: Ollama模式提示"模型未找到"?

**解决方案**:
```bash
# 查看已安装的模型
ollama list

# 下载模型
ollama pull llava
```

### Q3: 视频分析太慢?

**优化方案**:
1. **使用更小的模型**: llava 比 llava:34b 快很多
2. **增加抽帧间隔**: 从5000ms改为8000ms或10000ms
3. **使用云端API**: Gemini比本地Ollama快
4. **升级硬件**: 使用带GPU的电脑

### Q4: 图像生成失败?

**排查步骤**:
1. 检查API密钥是否正确
2. 点击"测试"按钮验证连接
3. 查看日志输出的错误信息
4. 如果是自定义模式,检查Base URL和模型名称

### Q5: 批量处理中某些视频失败?

**说明**:
- 软件会跳过失败的视频继续处理下一个
- 完成后会显示失败的文件列表
- 可以单独重新处理失败的视频

### Q6: 输出文件在哪里?

**答案**:
- 默认输出目录: `./drafts`
- 点击 **"📁 打开输出"** 按钮自动打开文件夹
- 输出文件命名格式: `hand_drawn_原文件名.mp4`

## 性能参考

### 处理时间估算(单个10分钟视频)

| 配置 | 抽帧间隔 | 视频分析 | 图像生成 | 总耗时 |
|------|---------|---------|---------|--------|
| Ollama(llava) | 5秒 | 约4分钟 | 约3分钟 | ~7分钟 |
| Ollama(llava:13b) | 5秒 | 约8分钟 | 约3分钟 | ~11分钟 |
| Gemini | 5秒 | 约1分钟 | 约3分钟 | ~4分钟 |
| 模拟模式 | 5秒 | 即时 | 约1分钟 | ~1分钟 |

### 硬件要求

**最低配置**:
- CPU: Intel i5 或同级
- 内存: 8GB
- 显存: 4GB (用于 Ollama llava)
- 硬盘: 10GB 可用空间

**推荐配置**:
- CPU: Intel i7 或同级
- 内存: 16GB
- 显存: 8GB (用于 Ollama llava:13b)
- 硬盘: 20GB 可用空间
- GPU: NVIDIA 显卡(支持CUDA)

## 商业部署建议

### 面向不同客户群体

**个人用户套餐**:
- 推荐模式: Ollama + llava
- 特点: 免费,隐私,离线
- 话术: "完全本地运行,视频数据不上传,保护您的隐私"

**专业用户套餐**:
- 推荐模式: Ollama + llava:13b 或 Gemini
- 特点: 效果好,速度快
- 话术: "采用最先进的AI模型,分析精准度高"

**企业用户套餐**:
- 推荐模式: 自定义API + 自建推理服务
- 特点: 可定制,数据安全,稳定可靠
- 话术: "支持对接您自己的AI服务,完全可控"

### 定价参考

1. **免费版**: 使用Ollama本地模式,免费无限制
2. **标准版**: 提供少量云端API额度
3. **专业版**: 提供更多API额度 + 技术支持
4. **企业版**: 无限制使用 + 定制开发

## 更新日志

### v1.0 (2025-10-13)

**新增功能**:
- ✨ 支持 Ollama 本地视觉模型进行视频分析
- ✨ GUI 新增视频分析模式选择
- ✨ 支持多种 Ollama 视觉模型(llava系列)
- 🎨 优化界面布局,使用选项卡式设计
- 📦 批量处理功能

**支持的AI平台**:
- 视频分析: Ollama, Gemini, 通义千问, 自定义API, 模拟模式
- 图像生成: 通义千问, Gemini, DeepSeek, Kimi, 智谱AI, 百川, 01.AI, OpenAI, 自定义API, 模拟模式

## 技术支持

如有问题,请查看:
- 详细文档: `OLLAMA_USAGE.md`
- 配置示例: `config.ini`
- 日志文件: `workflow.log`

祝你使用愉快! 🎨✨
