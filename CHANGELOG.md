# 更新日志

## v1.0 (2025-10-13) - 重大更新

### 🎉 新增功能

#### 1. Ollama 本地视觉模型支持 ⭐
- ✅ 实现 `OllamaVideoAnalyzer` 类支持本地视频分析
- ✅ 支持多种 Ollama 视觉模型:
  - llava (推荐,速度快)
  - llava:13b (效果好)
  - llava:34b (效果最好)
  - bakllava
  - llava-phi3
  - llava-llama3
- ✅ 完全本地运行,无需网络,数据不上传
- ✅ 免费使用,无API费用
- ✅ 智能连接测试和模型检测

#### 2. GUI 视频分析模式选择
- ✅ 在"高级设置"选项卡新增**视频分析模式**区域
- ✅ 下拉菜单选择分析模式:
  - Ollama本地模型(推荐)
  - Google Gemini
  - 通义千问视频
  - 自定义逐帧API
  - 模拟模式
- ✅ Ollama模型选择下拉菜单
- ✅ 自动保存和加载配置

#### 3. 通用视频分析器架构
- ✅ `UniversalVideoAnalyzer` 工厂类
- ✅ 5种分析模式支持:
  - `ollama` - Ollama本地模型 (新增)
  - `gemini` - Google Gemini
  - `qwen_video` - 通义千问视频
  - `frame_by_frame` - 自定义逐帧API
  - `simulate` - 模拟模式
- ✅ 统一的接口和错误处理

### 🎨 界面优化

- ✅ GUI 采用紧凑选项卡式设计
- ✅ 高度从700px优化到550px
- ✅ 使用 `ttk.Notebook` 分组功能
- ✅ AI模式选择改为下拉菜单(原13个单选按钮)
- ✅ 所有padding减小,界面更紧凑

### 🔧 功能完善

#### 图像编辑
- ✅ 支持 OpenAI 兼容接口的 `/v1/images/edits`
- ✅ 修复 multipart/form-data 请求格式
- ✅ 支持 URL 和 b64_json 两种响应格式
- ✅ 完善的错误处理和降级机制

#### 工作流
- ✅ `gui_workflow.py` 集成 Ollama 视频分析
- ✅ 自动检测和切换分析模式
- ✅ 进度回调支持
- ✅ 完善的日志记录

#### 配置管理
- ✅ config.ini 新增 `[video_analysis]` 配置段
- ✅ GUI 自动读取和保存视频分析配置
- ✅ 支持多种配置组合

### 📖 文档

- ✅ `OLLAMA_USAGE.md` - Ollama完整使用指南
- ✅ `GUI_COMPLETE_GUIDE.md` - GUI详细操作手册
- ✅ `README.md` - 更新主文档
- ✅ `CHANGELOG.md` - 本更新日志
- ✅ `start_gui.bat` - Windows快速启动脚本

### 🐛 修复的问题

1. **图像编辑API调用问题**
   - 修复: multipart/form-data 格式错误
   - 修复: 只支持 b64_json 格式
   - 新增: URL响应格式支持

2. **GUI配置问题**
   - 修复: 只检查qwen.enabled,忽略其他模式
   - 新增: 优先级检测所有启用的模式

3. **界面布局问题**
   - 修复: 窗口高度太高(700px)
   - 优化: 减小到550px
   - 优化: 使用选项卡分组

### 📊 性能改进

- ✅ Ollama 本地模式避免网络延迟
- ✅ 批量处理支持并发
- ✅ 智能图片限制模式

### 🔐 安全性

- ✅ Ollama 本地模式完全离线
- ✅ 视频数据不上传云端
- ✅ API密钥加密存储

## 支持的平台总览

### 视频分析平台(5个)

| 平台 | 代码 | 状态 | 说明 |
|------|------|------|------|
| Ollama | `ollama` | ✅ 已实现 | 本地视觉模型 |
| Google Gemini | `gemini` | ✅ 已实现 | 完整视频分析 |
| 通义千问视频 | `qwen_video` | ⚠️ 占位符 | 待实现 |
| 自定义逐帧 | `frame_by_frame` | ✅ 已实现 | OpenAI兼容 |
| 模拟模式 | `simulate` | ✅ 已实现 | 本地测试 |

### 图像生成平台(10个)

| 平台 | 代码 | 状态 |
|------|------|------|
| 通义千问 | `qwen` | ✅ 已实现 |
| Gemini | `gemini` | ✅ 已实现 |
| DeepSeek | `deepseek` | ✅ 已实现 |
| Kimi | `kimi` | ✅ 已实现 |
| 智谱AI | `zhipu` | ✅ 已实现 |
| 百川智能 | `baichuan` | ✅ 已实现 |
| 01.AI | `zeroone` | ✅ 已实现 |
| OpenAI | `openai` | ✅ 已实现 |
| 自定义 | `custom` | ✅ 已实现 |
| 模拟模式 | `simulate` | ✅ 已实现 |

## 技术债务

### 待实现功能

1. **通义千问视频分析**
   - 当前: 只有占位符
   - 计划: 实现完整的视频理解API调用

2. **更多视觉模型支持**
   - 计划: 支持更多Ollama视觉模型
   - 计划: 支持视频预处理优化

3. **性能优化**
   - 计划: GPU加速
   - 计划: 帧缓存机制
   - 计划: 分布式处理

### 已知问题

暂无重大问题。

## 向后兼容性

- ✅ 完全兼容旧版 config.ini
- ✅ 旧版GUI仍然可用(gui_main.py)
- ✅ 命令行模式不受影响

## 升级指南

### 从旧版升级

1. **保留旧配置**
   ```bash
   # 备份旧配置
   cp config.ini config.ini.backup
   ```

2. **使用新GUI**
   ```bash
   # 启动新版GUI
   python gui_main_compact.py
   ```

3. **配置Ollama**(可选)
   ```bash
   # 安装Ollama
   # 访问 https://ollama.com/download

   # 下载模型
   ollama pull llava
   ```

4. **更新配置**
   - 在GUI的"高级设置"中选择视频分析模式
   - 第一次运行会自动保存配置

## 商业影响

### 新增价值

1. **降低成本**
   - Ollama模式完全免费
   - 减少API调用费用

2. **提高隐私**
   - 本地运行,数据不上传
   - 满足企业级隐私要求

3. **灵活部署**
   - 支持纯本地部署
   - 支持混合云部署
   - 支持纯云端部署

4. **扩大客户群**
   - 吸引注重隐私的客户
   - 吸引预算有限的客户
   - 吸引技术爱好者

### 定价策略

建议的定价结构:

1. **免费版**
   - Ollama本地模式
   - 无限制使用
   - 社区支持

2. **标准版** ($29/月)
   - Ollama + 少量云端API额度
   - 邮件支持

3. **专业版** ($99/月)
   - 更多云端API额度
   - 优先支持
   - 批量处理优化

4. **企业版** (定制)
   - 无限使用
   - 私有化部署
   - 专属技术支持
   - 定制开发

## 贡献者

- 主要开发: Claude AI
- 需求方: 058-二创-灵魂画手项目

## 特别致谢

感谢Ollama项目提供优秀的本地AI运行平台!

---

**下一版本计划**: v1.1 (预计 2025-11)
- 实现通义千问视频分析
- 添加更多视觉模型
- 性能优化
- UI主题支持
