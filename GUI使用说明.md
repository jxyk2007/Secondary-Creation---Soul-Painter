# 灵魂画手 GUI 使用说明

## 🎨 简介
灵魂画手是一个AI驱动的视频二创工具，能够自动识别视频中的搞笑时刻，生成手绘风格插画，并精确插入到原视频中。

## 🚀 快速开始

### 1. 启动程序
双击 `启动GUI.bat` 或运行 `python run_gui.py`

### 2. 选择视频文件
点击"浏览"按钮，选择要处理的视频文件（支持MP4、AVI、MOV等格式）

### 3. 选择AI模式

#### 🔥 通义千问模式（推荐）
- 真实AI生成手绘图
- 效果最佳
- 需要API密钥
- 有免费额度

#### 🌟 Gemini模式
- Google AI生成
- 需要代理
- 需要API密钥

#### ⚡ 模拟模式
- 无需网络
- 使用OpenCV生成手绘效果
- 速度最快

### 4. 配置API密钥
如果选择通义千问或Gemini模式，需要输入对应的API密钥：
- **通义千问**: 在阿里云控制台获取DASHSCOPE_API_KEY
- **Gemini**: 在Google AI Studio获取API密钥

### 5. 调整设置（可选）
- **抽帧间隔**: 每隔多少毫秒抽取一帧（默认5000ms）
- **搞笑阈值**: 搞笑度评分阈值（0.1-1.0，默认0.85）
- **BGM音量**: 背景音乐音量（0.0-1.0，默认0.5）

### 6. 开始生成
点击"🎬 开始生成"按钮，程序将自动：
1. 抽取关键帧
2. AI分析搞笑时刻
3. 生成手绘插画
4. 合成最终视频

### 7. 查看结果
处理完成后，点击"📁 打开输出目录"查看生成的视频

## 📋 界面说明

```
┌─────────────────────────────────────┐
│           灵魂画手 v1.0              │
├─────────────────────────────────────┤
│ [选择视频文件]  📁 1.mp4             │ ← 选择要处理的视频
│                                     │
│ 模式选择:                           │
│ ○ 通义千问 (推荐)  ○ Gemini  ○ 模拟  │ ← 选择AI模式
│                                     │
│ API配置:                            │
│ [通义千问密钥] [_______________]      │ ← 输入API密钥
│ [测试API连接]                       │ ← 测试连接
│                                     │
│ 高级设置:                           │
│ 抽帧间隔: [5000]ms                  │ ← 调整参数
│ 搞笑阈值: [████████░░] 0.85         │
│ BGM音量:  [█████░░░░░] 0.5          │
│                                     │
│ [🎬 开始生成]      [📁 打开输出目录]   │ ← 操作按钮
│                                     │
│ 进度显示:                           │
│ [████████░░] 80% 正在生成手绘图...   │ ← 实时进度
│                                     │
│ 日志输出:                           │
│ ┌─────────────────────────────────┐  │
│ │ [09:30:15] 开始处理视频...      │  │ ← 详细日志
│ │ [09:30:20] 抽取6张关键帧        │  │
│ │ [09:30:25] 正在生成手绘图...    │  │
│ └─────────────────────────────────┘  │
└─────────────────────────────────────┘
```

## ⚙️ 高级功能

### API密钥配置
API密钥会自动保存到`config.ini`文件中，下次启动无需重新输入。

### 测试API连接
点击"测试API连接"按钮可以验证API密钥是否正确配置。

### 实时日志
日志窗口显示详细的处理过程，帮助了解当前状态和排查问题。

### 进度显示
进度条和状态文本实时显示处理进度，包括：
- 抽取关键帧
- AI分析内容
- 生成手绘图
- 合成视频

## 🔧 故障排除

### 1. 程序无法启动
- 确保已安装Python 3.9+
- 检查所有依赖是否安装：`pip install opencv-python requests`

### 2. API连接失败
- 检查网络连接
- 验证API密钥是否正确
- 通义千问需要DASHSCOPE_API_KEY
- Gemini可能需要配置代理

### 3. 视频处理失败
- 确保FFmpeg在当前目录或系统PATH中
- 检查视频文件格式是否支持
- 查看日志了解具体错误

### 4. 生成效果不理想
- 调整搞笑阈值（降低阈值获得更多搞笑点）
- 修改抽帧间隔（降低间隔获得更多帧）
- 尝试不同的AI模式

## 📁 输出文件

处理完成后，在`./drafts`目录下会生成：
- `hand_drawn_[视频名]_[时间戳].mp4` - 最终合成视频
- `./frames/` - 抽取的关键帧
- `./illustrations/` - 生成的手绘图
- `analysis_results.json` - 分析结果数据

## 🎯 效果特点

1. **精确插入**: 手绘图在对应时间点精确插入，暂停原视频1秒
2. **尺寸匹配**: 自动调整手绘图尺寸与原视频一致
3. **智能分析**: AI识别最搞笑的时刻进行处理
4. **容错机制**: API失败自动降级到模拟模式

## 💡 使用技巧

1. **选择合适的视频**: 包含人物表情和动作的视频效果更好
2. **调整阈值**: 搞笑阈值太高可能导致没有搞笑点被识别
3. **网络环境**: 通义千问API需要稳定的网络连接
4. **视频长度**: 建议处理5分钟以内的视频，太长会耗时较久

---

**技术支持**: 如遇问题请查看日志输出或联系开发者
**版本**: v1.0
**更新日期**: 2025-09-28